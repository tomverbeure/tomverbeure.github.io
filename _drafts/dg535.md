
Main power supply connector:

```
Should be       Actual
+10         ->  0           : comes from other board
+15         ->  +15
+9          ->  +12 
+5          ->  +7
GND         ->  GND
-9          ->  0
-15         ->  -15
```


Diagnosis for now:

* PCB requires BR81D bridge for BR501, but has been bodged with 4x 1N5822 Schottky diodes, which matches the schematic.
    
    * Service manual: doesn't have BR501, shows 4 1N5822 diodes instead.
    * 1 1N5822 fell off, probably there reasons why there is no -9V.
    * Service manual lists KBP201G as alternative. Available at Mouser.
    * 1N5822 has lower diode drop than diode bride. Does this increase the voltage
      at the output of the 5V?

* PCB has 10 Ohm/5 W bypass resistor R512 across U501 voltage regulator.
* Voltage measured on 5V line is 7V, probably due to this resistor.
* Regulator is an LM340T-5 (also has 7805 marker on it.) TO220 package
* There are jumpers on the 5V source before it's used
* 9V (present as +12) goes to detection circuit, but -9V (not present) does not.

Plan:

* Check capacitors
* Buy 2x KBP201G 
* Buy LM340T-5 just to be sure
* Buy replacement resistor?
* Remove bodge 1N5822 diodes
* Cut 5V jumper, use external power supply. Also use external power supply for +/-9V?

* LCD cable: 2x7=14 pins
* Keyboard cable: 2x10=20 pins

Loose red and orange wires: +20 and -20 V. Go to option 2 PCB at the bottom.


Actions taken:

* Remove 4 jumpers
    * The schematic only shows 3 jumpers?
    * +15V
    * 5V: 2 jumpers in the center. Connected to eachother
    * -15V
* Remove bodge BR501
    * This disconnects everything related to 5V and unregulated +9V and -9V 
* Power on: +15V and -15V are fine. The rest is obviously dead without diode bridge.
* +9 on J5 connected +9 on J7
* -9 on J5 NOT connectoed -9 on J7: trace is burnt. This trace goes next to the 10 Ohm resistor, but is not connected to it.
    IS THERE A SHORT ON THE -9V rail?
* Connect bench supply to GND and +9V pins on J7
* 5V roughly tracks voltage on bench supply: it doesn't regulate to 5V
* Remove LM340T-5
* Reconstruct -9V wire from bridge to J7

* pin 9 of U502 (LM2901 opamp) patched to common R611 and R609 -> 5V
* [BR81D bridge: 100V, 2 AMP](https://www.circuitspecialists.com/bridge-rectifiers-2-amp)
* resistor: DALE RS-5-70: 70 Ohm. I measure 10 Ohm.
* Re-installed LM340T-5. With removed 10 Ohm resistor, output voltage is 5V now.
* Re-installed heatsink
* Apply 5V to J7. No major power consumption
* Installed jumper header
* Installed 4 jumpers. Did not install 10 Ohm resistor!
* Apply 10V to J7 
* Apply power: 7805 starts heating up, to 65C. Then unplugged.
* Why +/-12V on +/-9V pins?
* Switching 10V on or off has no impact: the nDROPOUT and nRESET pins are always high.
    * Makes sense: test signals are checked if they are higher than 10V, not lower
* Need 10 MHz clock from bottom PCB -> use SYNC output of function generator
    * 5 MHz clock is working
    * pins on Z80 are toggling
* Unscrew LCD and keyboard/LEDs PCBs
    * top-middle screw of keyboard/LEDs PCB has teflon ring instead of metal one
* Figuring out cable orientation for LCD and keyboard/LEDs
    * Was incorrect for keyboard/LEDs
* LEDs now light up, but not activity or anything.
* LCD board has no activity at all, not even backlight
    * Type: SDP-T694V-0 2020C
    * There are other SDP-T694V-0 that are smaller in size. The 2020C is essential.
    * LCD backlight is coming straight from 120V primary transformer winding.
* Increase 10V input to 15V instead of lowering... Check if nRESET and nDROPOUT go low.
    * The go low
    * Without 10V, after power up, clock is often not running.
* Probe Z80 pins: nINT is always low!
    * U310 AND between TIMER_INT and GPIB INT
    * TIMER_INT is always high
    * nINT_CLR (output of U308/9) is always high
    * U308: 3 to 8 demultiplexer with inverted output
        * nG2A/nG2B -> connected to nIO_OP -> toggles
        * G1 -> connected to A7: when high -> 1 of 8 outputs goes low
    * U209/17: no 1kHz out. There is 2.5MHz on input 18.
    * Z80 databus is toast
* ROM dump: AM27C128@DIP28 -> DG535_ROM_v2.0_SN4633.bin
    * Use MiniPro_GUI
* Record address bus with logic analyzer
    * The CPU seems to be very active?
* Use Ghidra to check out program flow. 
    * All major places are triggered.
* 

* Current boost resistor: [Single Resistor Provides Extra Current from a Linear Regulator](https://www.analog.com/en/resources/design-notes/single-resistor-provides-extra-current-from-a-linear-regulator.html)


# LCD panel

* Type: SDP-T694V-0 2020C
* 120V power supply for backlight. One side fed with Dale RN55C series resistor
* 14 pins
* 20x1
* [Potential replacement on eBay UK](https://www.ebay.com/itm/252286333066)
* HD44780U
* Schematic vs the rest of the world:
    * 7  GND        - 
    * 8  Zener      - 
    * 6  Contrast   - 
    * 9  A0         - 
    * 5  A1         - 
    * 10 CS         - 
    * 4  D0         - 
    * 11 D1         - 
    * 3  D2         - 
    * 12 D3         - 
    * 2  D4         - 
    * 13 D5         - 
    * 1  D6         - 
    * 14 D7         - 


# Memory map:
* ROM: mem - 0x0000 - 0x3FFF
* RAM: mem - 0x4000 - 0x5FFF

* 0x00 - 0x7F: U404 decoder
    * 0x00 - 0x07: nIEEE_CS
    * 0x08 - 0x0F: nCTR1_CS
    * 0x10 - 0x17: nCTR2_CS
    * 0x18 - 0x1F: nCTR3_CS
    * 0x20 - 0x27: nCTR4_CS
    * 0x28 - 0x2F: nCTR5_CS
    * 0x30 - 0x37: nDAC_CS
    * 0x38 - 0x3F: nDAC_CLR
    * 0x40 - 0x47: nDISP_CS
    * 0x48 - 0x4F: nP1_CS
    * 0x50 - 0x57: nP2_DAC_DEST_CTRL_CS
    * 0x58 - 0x5F: nP3_CS
    * 0x60 - 0x67: nP4_CS
    * 0x68 - 0x6F: nP5_CS
    * 0x70 - 0x77: nP6_CS
    * 0x78 - 0x7F: nP7_CS

* 0x80 - 0xFF: U308 decoder
    * 0x80 - 0x87: nP8_CS     -> J40:13 
    * 0x88 - 0x8F: nP9_CS     -> J40:28 
    * 0x90 - 0x97: nP10_CS    -> U202:11
    * 0x98 - 0x9F: nP11_CS    -> U203:11
    * 0xA0 - 0xA7: nFLAG_CLR  -> U102
    * 0xA8 - 0xAF: SPARE
    * 0xB0 - 0xB7: nINT_CLR   -> U307:1
    * 0xB8 - 0xBF: nCTR6_CS   -> U210:1


* 120V: 19V AC / 39V AC
* 100V: 23V AC / 46V AC

Transformer: 

* core: 77 mm x 66mm
* bolt holes: 64 mm x 50 mm

* Reassembly:
    * Connect flat cables for keyboard/LEDs and LCD panel to top PCB
    * Connect wide flat cable J40 between top and bottom
    * Connect main power cable between transformer and top PCB
    * Connect fan wires
    * Connect J16 (close to front panel) between top and bottom PCB
    * Connect keyboard/LEDs cable to keyboard PCB
    * Connect LCD cable to LCD PCB
    * top to bottom power cable

Bottom PCB power rails:

* U907: -5.6V OK
    * Not marked on PCB, but C922 is next to it.
    * Output is left pin 
* U903: 5.2V OK
    * Output is center pin 2
* U909: -2V OK
    * Output is right pin 3
* U908: -5.2V OK
    * Output is left pin 3
* Jumper section has 6V OK

* Disconnect J40. External clock and contrast to GND -> display on, but still reboot loop.
* Keyboard and board-to-board power also disconnected. Still in a boot loop. Sigh.

