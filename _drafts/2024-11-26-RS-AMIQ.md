---
layout: post
title: Rohde & Schwarz AMIQ Teardown and Repair 
date:   2024-11-26 00:00:00 -1000
categories:
---

* TOC
{:toc}

# Introduction

Every few months, a local company auctions off all kinds of lab, production and test equipment. 
I shouldn't be subscribed to their email list but I am, and that another way to end up with more
stuff that I don't really need.

During a recent auction, I got my hands on a Rohde & Schwarz AMIQ, an I/Q modulation
generator, for a grand total of $45. Add to that another 30% for the auction fee and taxes and
you're still paying much less than what others would pay for a round of golf? But instead of 
one morning, this thing has the potential to keep me busy for many weekends, so what a deal! 

[![AMIQ frontside view](/assets/amiq/amiq_frontside.jpg)](/assets/amiq/amiq_frontside.jpg)
*(Click to enlarge)*

A few days after "winning" the auction, I drove to a dark dungeon of a warehouse in San Jose
to pick up the loot.

The AMIQ has a power on/off button power button and 3 LEDs and that's in terms of user interface.
There are no dials and there's no display. So without any other options, I simply powered it up
and I was immediately greeted by the ominous clicking of a spinning disk hard drive. I was right: 
this thing would keep me entertained for at least little bit!

[![AMIQ backside view](/assets/amiq/amiq_backside.jpg)](/assets/amiq/amiq_backside.jpg)
*(Click to enlarge)*

As I write this, I don't have the AMIQ fully up and running, and I'm not sure if I'll ever
be able to restore it a full working state, but I've made good progress and some of the
things I've learned might be useful to others.

In this blog post, I'll discuss the functionality of the R&S AMIQ and go through the steps of
reviving the PC that is enclosed in the machine.

# The Rohde & Schwarz AMIQ Modulation Generator

Reduced to an elevator sales pitch, the AMIQ can be described as *a sample streaming buffer that 
is connected to a 2 DAC that can run at a rate of up to 105MHz*. Or even more succinct: it's
*a 2-channel arbitrary waveform generator (AWG) with a deep sample buffer*. That's it!

The I and Q output channels of the AMIQ will typically contain quadrature modulation signals
that gets sent to a vector signal generator such as a Rohde & Schwarz SMIQ for the actual
high-frequency modulation. In a typical setup, the AMIQ is used to generate the baseband 
modulated signal and the SMIQ shifts that baseband signal to an RF frequency.

![WinIQSIM - AMIQ - SMIQ setup](/assets/amiq/amiq_smiq_setup.png)

Since the AMIQ has no user interface, the waveform data is provided by some external control
device. This could be a PC that runs R&S WinIQSim software or even a SMIQ because it has the ability 
to drive an AMIQ. You can also create your own waveforms and upload them via floppy disk, GPIB
or an RS-232 interface.

The block diagram of the AMIQ is straightforward and quite similar to the one of my
[HP 33120A function generator](/2023/01/02/HP33120A-Repair-Shutting-Down-the-Eye-of-Sauron.html#a-walk-through-the-block-diagram):

[![AMIQ block diagram](/assets/amiq/amiq_block_diagram.png)](/assets/amiq/amiq_block_diagram.png)
*(Click to enlarge)*

On the left are 2 blocks that are shared:

* a clock synthesizer 
* waveform memory

And then for each channel:

* 14-bit D/A converter
* analog filter
* output section with amplifier/attenuator
* optional differential output driver

The major blocks are surrounded by a large amount of DACs that are used to control everything from
local 10MHz clock oscillator, gain and offset of output signals, clock skew between I and Q signal
and much more.

You could do all of this with a modern SDR setup, except that the specifications of the AMIQ units
are dialed up a notch. Both channels are completely symmetrical to avoid modulation errors at the
source. If there's a need to compensate for small delay differences in, for example, the external 
cables, you can compensate for that by changing the skew between clocks of the output DACs with a 
precision of 10ps. Similarly, the sample frequency can be programmed with 32-bit accuracy.

In addition the main I/Q outputs the front, there are a bunch of secondary input and output signals
available: 

* 10MHz reference input and output
* digital sample clock
* trigger input
* marker output
* external filter loopback output and input
* bit error rate measurement (BER) connector (AMIQ-B1 option)
* differential I/Q output (AMIQ-B2 option)
* parallel interface with digital value of the samples that are sent to the DAC (AMIQ-B3 option)

There are 3 different AMIQ versions:

* 1110.2003.02: 4M samples 
* 1110.2003.03: 4M samples
* 1110.2003.04: 16M samples

I have an AMIQ-04 but it reports itself as an AMIQ-03, which I think is the cause of not being able to
make everything work yet.

# WinIQSim Software

While it is possible to control the AMIQ over RS-232 or GPIB with your own software, you'd have
a hard time matching WinIQSim in terms of features. 

[![WinIQSim Main Multi-Carrier window](/assets/amiq/AMIQ_Main_Multi_Carrier_window.png)](/assets/amiq/AMIQ_Main_Multi_Carrier_window.png)
*(Click to enlarge)*


With WinIQSim, you can select one of the popular communication protocols from the late nineties and
early 2000s, fill in digital framing data, apply all kinds of distortions, generate a waveform and
send it to the AMIQ. Some of the supports formats include CDMA2000, IEEE 802.11a WLAN, TD-SCDMA and
more.

But you don't have to use these official protocols, WinIQSim can generate any kind of FSK, QPSK,
QAM or signal.

You need a license for some of the communication protocols. The license is linked to the AMIQ device,
not the PC, but the license check is pretty naive, and while I haven't tried it yet myself, the
EEVblog forum has discussions about how to enable features yourself. My device only came with a license
for IS-95 CDMA. 

# Inside the AMIQ

It's trivial to open up an AMIQ: after removing the 4 feet in the back with a regular
Philips screwdriver, you can simply slide off the outer case.

It has 2 major subsystem:

* the top has a signal generation PCB

  [![AMIQ signal generation side](/assets/amiq/amiq_siggen_side.jpg)](/assets/amiq/amiq_siggen_side.jpg)
  *(Click to enlarge)*

  It looks incredibly clean and well layed out and I love how they printed the names of different
  sections on the shielding.

* the bottom contains all the components of a standard PC

  [![AMIQ top inside view - PC motherboard](/assets/amiq/amiq_pc_motherboard_side.jpg)](/assets/amiq/amiq_pc_motherboard_side.jpg)
  *(Click to enlarge)*


# The Signal Generation PCB

Let's remove the shielding plates to see what's underneath. I had to drill out one of the screws because
the head was stipped. (Did somebody before me already try to repair it?)

[![AMIQ signal generation board](/assets/amiq/amiq_siggen_uncovered.jpg)](/assets/amiq/amiq_siggen_uncovered.jpg)
*(Click to enlarge)*

The bottom left and right sections are perfectly symmetrical, as one would expect for a device that has the
ability to tune skew mismatches with a 10 ps precision.

Annotated, it looks like this:

[![AMIQ signal generation annotated](/assets/amiq/amiq_siggen_annotated.jpg)](/assets/amiq/amiq_siggen_annotated.jpg)
*(Click to enlarge)*

Rohde & Schwarz recently made the terrible decision to lock all their software and manuals behind an approved corporate
log-in wall, but luckily some of the most important AMIQ assets can be found online elsewhere, including the operating
and service manual.

Even better, the service manual contains the full schematic!

Let's dig a bit deeper into the various aspects of the design.

**Signal path test points**

One of the awesome features of the PCB is the generous amount of test points. We're not
just talking PCB test point against which you can hold your oscilloscope probe or even header
pins, though there are plenty of those too, but full on header SMA-like connector 

![AMIQ test connectors](/assets/amiq/amiq_test_connectors.jpg)

**Reference clock**

Like all professional test and measurement equipment, the AMIQ uses a 10MHz clock as reference. This clock
can come from outside or it can be generated locally with a 10MHz crystal. It's common for high-end equipment
to have an oven controlled crystal oscillator (OCXO), but in this case we have to make do with a lower spec'ed
temperature controlled one (TCXO). 




# The PC System


  We can see the motherboard, power supply, floppy drive and hard drive. On the
  bottom right, an ISA plug-in card connects the motherboard to the signal generation
  PCB.

The signal generation part is for another time, let's start with the motherboard
because there's almost certainly a bunch of work to do there.


The motherboard is an MSI MS-5169. YOu can find a lot of details here, but it's an pretty
standard late nineties affair with support for a large selection of CPU from Intel, AMD and
Winchip, SDR UDIMM RAM or 72-pin EDO RAM, 4 PCI, 1 AGP and 2 16 slots, floppy and IDE interface
and the usually assortment of smaller interfaces for mouse, keyboard serial port etc.

It was produced in late nineties and early 2000s, which is right around the time of the
electrolythic capacitor disaster that hit pretty much all electronics back and, boy does
mine suffer from it! Have a look at some of the pictures below:

XXXXX

There are around 30 electrolythic caps on the mother board and while it's not possible to
visually determine if the smaller ones have issues, all the larger ones have traces of rust
at the top. I didn't see any signs of leaks, which is great because the fluid inside the cap
is highly corrosive. It's much easier to replace a capacitor than to reconstruct hairline
PCB traces that have melted away.

Conventional wisdom says that when faulty capacitors are suspected, you should first replace
all of them before powering on the PC. I was impatient and powered it on anyway. I was immediately
greeted with a bunch of beeps,  good, because that means that there's still some life in the
motherboard, and the ominous clicking sound of a failed hard drive.

# Recapping the motherboard

Recapping is a pretty common process and you can find plenty of videos on Youtube about it.

But what's usually missing is a list of all the caps that must be replaced. Here's the
list of what's needed for the MS-I5619:

When making a purchase list of replacements caps on Mouser, I didn't pay close attention to the
equivalent series resistance (ESR) of the new caps. When used as part of a switch mode power
supply, some capacitors will continuously be exposed to high-frequency charge-discharge cycles.
In such a case, a high series resistance will result in power being wasted inside cap, thus
reducing power efficiency and higher temperature which will ultimately reduce the life of the new
caps as well.

Low ESR capacitors are only a bit more expensive than general purpose ones, so it's not really worth
cheaping out on them. On the other hand, how long will you really use this motherboard anyway?

For the recap itself, I used my brand new XXXXX desoldering station, a Xmas gift from my wife.
She knows me well!

This was my first recap ever and even 25 year old motherboards are already sufficiently advanced
to make it a delicate operation.

Here are some random notes about techniques that I learned along the way:

In an ideal world, you'll be able to suck enough solder out of the through-hole so that you
can simply insert a replacement cap back and and solder it. In practice, that rarely happens.
Larger caps such as the 1000uF and 1500uF ones have thicker leads and a larger through-hole
diameter. For those, there is a decent chances that at least one of the hole will free up. I
never had a case where both holes were unclogged.

One of the nice benefits of the heated desoldering pump was that the tip is hollow so it will
immediately warm up the solder around the whole lead, instead of heating it up at one side
only.

It helps to wiggle around the hot tip in circles to loosen up the solder all around.

Putting some amount of force on the cap that needs to be removed is inevitable, but you can't
overdo it because you might strips out the copper lining of the hole itself.

First adding instead of immediately removing solder can work wonders. The extra solder can
increase the contact surface between the solder and the soldering iron tip and make the solder
heat up much easier.

For small capacitors with small lead spacing such as the 10uF and 100uF caps, the desoldering
pump wasn't very useful. I had best results but adding enough new solder so that it bridged both
leads, and then after heating it up more, then cap would often just fall out. Gravity for the win!

There can be a large variance in the effort required to remove a capacitor. Some could be removed
with almost no effort. Others took ages. It depends on the amount of ground planes and other elements
that are good at whisking away heat: you just can't heat the thing up fast enough.

One option that I didn't try is to cut away the capacitor with nose pliers so that only 2 lead
stubs are left. This way, instead of have to extract 2 leads together, you can remove one at a
time which is much easier.

**Inserting new caps**

When you can't unclog a solder hole, inserting a new cap won't be as easy. Here are some techniques that
I used.

I shorten the leads first and make one lead around 2mm shorter than the other. The longest lead is
obviously the one I want to put in place first. When there are no nearby obstacles that limit my
ability to maneuver the cap, I make the longest lead around 5mm and the shorter one around 3mm. Shorter
leads reduce that chance that they will buckle when you're putting a bit of pressure on them to get them
through the hole.

If there are nearby connectors or other components, I makes the leads as long as they need to be so that
the cap rises above its surroudings before it's inside the hole. The chance to buckle a lead is higher
now, but at least your fingers will have something to grip on.

You'll be holding 3 things at the same time: the soldering iron on one side of the PCB, the PCB itslef and
the new cap on the other side, which is a little bit of a challenge with only 2 hands.

Since you'll be looking on the side of the soldering iron, you don't have the luxury to monitor the placement
of the cap. For this reason, you need to make sure that the residual solder after removing the old cap doesn't
bulge but is slightly sunken into the hold. This way, when you place the longer lead of the cap on the PCB,
it will stay there and not glide off. Use soldering wick on the component side of the PCB to remove excess
solder if the solder is bulging out of the hole.

Here's an example of that: the holes of the left cap have already been wicked and are indented. Those of the
right cap have solder bulging out.

With the longer lead positions inside the indented hole, it's time to heat up that hole from the other side.
An indented hole usually means that there's not a lot of solder in the full at all, so I use a fine tipped
soldering iron and poke it perpendicalar into the hole to reach the solder. Soon the lead will shoot
through the hole. This is the point where I'll add more solder to this hole so that it's easier to
heat up the solder.

You now need to get the second lead in. If the distance between the 2 holes is small enough, you can heat
the solder of both holes at the same time but squeezing your iron between the 2 holes, just like you could
when using the gravity method to remove small caps.

If that's not possible, you'll have to alternate between the two leads and gradually work the capacitor
into its position.

# Disassembly

* Remove 4 back feet
* Slide case away
* Cut zip ties
* Unplug 2 flat cables
* Unplug power cable
* Unscrew 4 screws of CPU fan
    * 12V neolec. Screw holes: 33x33mm
* Unplug memory stick: 8x 48LC8M8A2 8MByte per chip -> 64MByte total
* Loosen 4 screws for the motherboard back holding bracket and slide it back
* Unplug speaker cable
* Remove 3 motherboard holding screws
* Remove 6 hex screws for the parallel port, RS232 and X13 connector
    * The motherboard is now loose.
    * It's an [MSI MS5179](https://groups.io/g/Rohde-and-Schwarz/topic/r_s_amiq_generator_need/52310294)
    * [The Retro Web](https://theretroweb.com/motherboards/s/msi-ms-5169-al9)
    * size: 300x
* Lift the motherboard from the left
* Unplug the 2 flat cables on the right
* Unplug right cable with blue and red wires
* Remove heat sink from CPU: push down on the metal clip close to the DRAM slots
    * Remove CPU
* Remove ISA extension slot

Removing HD:
* Remove power cable attachment screw
* Remove 2 screws on aluminum HDD holding plate
* Disconnect cables
* Remove 2 HD attachment screws
* Slide out HD
* Backup HD:
* `sudo apt install gddrescue`
* `ddrescue /dev/<src device> amiq-backup.img`

* Take motherboard out
* Plug in PCI card -> boot screen
* Replace CR2032

* Disk image through http://www.ko4bb.com/getsimple/index.php?id=manuals
* Compact Flash

```
tom@zen:~/projects/tomverbeure.github.io/assets/amiq$ sudo ddrescue -f amiq_hdd.img /dev/sda log
GNU ddrescue 1.23
Press Ctrl-C to interrupt
     ipos:    3253 MB, non-trimmed:        0 B,  current rate:   1003 MB/s
     opos:    3253 MB, non-scraped:        0 B,  average rate:   1084 MB/s
non-tried:        0 B,  bad-sector:        0 B,    error rate:       0 B/s
  rescued:    3253 MB,   bad areas:        0,        run time:          2s
pct rescued:  100.00%, read errors:        0,  remaining time:         n/a
                              time since last successful read:         n/a
Finished                                     
```

Took around 8 minutes even if 'Finished' showed up immediately.



# Capacitors

Caps: they're all aluminum electrolytic radial ones.

* scan front to back - left to right

* 1x 470uF/16V - USB connectors 
* 3x 10uF/25V (tiny)
* 2x 1500uF/10V
* 4x 1000uF/6.3V
* 1x 1000uF/6.3V
* 1x 470uF/16V

* 1x 10uF/25V (tiny)
* 1x 470uF/16V
* 4x 1000uF/6.3V
* 1x 100uF/16V

* 3x 1000uF/6.3V
* 1x 10uF/25V
* 1x 100uF/16V

* 1x 1000uF/10V
* 1x 100uF/16V

* 1x 470uF/16V
* 1x 100uF/16V

* 2x 100uF/16V

* 1x 470uF/16V
* 2x 10uF/25V

* 2x 47uF/25V
* 1x 100uF/16V

Summary:

* 5x 470uF/16V      - 8.3mm diam    - 3.2mm spacing
* 2x 1500uF/10V     - 10.2mm        - 5.5mm
* 10x 1000uF/6.3V   - 8.3mm         - 3.6mm
* 7x 10uF/25V       - 4.2mm         - 2mm
* 7x 100uF/16V      - 5.3mm         - 2mm
* 2x 47uF/25V       - 5.3mm         - 2mm

# Booting up

* Plug in VGA GPU
    * ATI Rage XL 8MB PCI
    * $20.72 on eBay
* [PCI riser card](https://www.mini-box.com/s.nl/it.A/id.289/.f?sc=8&category=1549)
    * $3

* RAM test first
* Use keyboard with PS/2
* DEL key due RAM test to enter BIOS setup screen

# WinIQSim

* Start software
* ARB -> Select Target ARB ... -> AMIQ03
* ARB -> AMIQ -> AMIQ Interface and Transmission Options -> RS 232 -> Default baud rate: 115200
* ARB -> AMIQ -> Remote Control and BERT..

  This will try to access remote. See remote control window.

  * Test and Adjustment
  * Selftest
  * Send command: doesn't work

* quit WinIQSinm
* Putty
  * serial, com3, 115200
  * Terminal: 
    * Local echo: force on
  * Open
  * `*IDN?` -> ...
  
```
*RST
CLOCK 100MHz
ARM
TRIG
SClock EXTFAst   <- switches to external clock input
```

* Calibration of level and offset for I and Q

```
*RST
CAL:ALL?
```

Takes about 30s. Should return 0 if no error.

* Won't work when PCI VGA is not plugged in

  * This is because Primary Display is set to VGA/EGA in "Advanced CMOD Setup"
  * Set to "Absent"
  * After this, VGA card will still work when plugged in, but only in PCI slot
    that is closest to the CPU

* After bootup: "Error: 243, "AMIQ variant check failed;Board-ID 155: Bit:24/24 Vers 05/06"


# References

**Rohde & Schwarz documents**

* [R&S AMIQ Operating Manual](/assets/amiq/AMIQ_OperatingManual_en_08.pdf)
* [R&S AMIQ Service Manual with schematic](/assets/amiq/Rohde_Schwarz_AMIQ_Service_Manual_with_schematics.pdf)
* [R&S AMIQ Overview](/assets/amiq/AMIQ_overview.PDF)
* [R&S AMIQ Datasheet](/assets/amiq/Rohde-Schwarz-AMIQ04-Datasheet.pdf)

* [R&S Floppy Disk Control of the I/Q Modulation Generator AMIQ](/assets/amiq/amiq_floppy_disc_control.pdf)
* [R&S Software WinIQSIM for Calculating I/Q Signals for Modulation Generator R&S AMIQ](/assets/amiq/Software Manual WinIQSIM - ES Documentation.pdf)
* [R&S Creating Test Signals for Bluetooth with AMIQ / WinIQSIM and SMIQ](/assets/amiq/R&S - Creating Test Signals for Bluetooth with AMIQ.pdf)
* [R&S WCDMA Signal Generator Solutions](/assets/amiq/R&S - WCDMA Signal Generator Solutions.pdf)
* [R&S Golden devices: ideal path or detour?](/assets/amiq/R&S Golden devices - ideal path or detour.pdf)
* [R&S Demonstration of BER Test with AMIQ controlled by WinIQSIM](/assets/amiq/R&S - Demonstration of BER Test with AMIQ controlled by WinIQSIM.pdf)

**Other AMIQ content on the web**

* [Lost Manual - Rohde & Schwarz](https://www.lost-manuals.com/en/manufacturer/rohde-schwarz)
* [R&S Groups.io AMIQ repair thread](https://groups.io/g/Rohde-and-Schwarz/topic/r_s_amiq_generator_need/52310294)
* [EEVBlog repair discussion](https://www.eevblog.com/forum/testgear/harddisk-image-for-rs-amiq-generator/)
* [EEVBlog AMIQ license key comment](https://www.eevblog.com/forum/testgear/enabling-options-for-rs-test-equipment/msg3468382/#msg3468382)
* [EEVBlog AMIQ license key comment](https://www.eevblog.com/forum/testgear/enabling-options-for-rs-test-equipment/msg4626139/#msg4626139)
* [EEVBlog AMIQ + SFQ as vector signal generator](https://www.eevblog.com/forum/testgear/rs-smiq-as-a-replacement-for-a-general-signal-generator/msg5400308/#msg5400308)
* [How to get error out of AMIQ?](https://forums.ni.com/t5/UVLabVIEW/How-to-get-errors-form-R-amp-S-AMIQ/td-p/3639064)

* [zw-ix has a blog - Getting an Rohde Schwarz AMIQ up and running](https://zw-ix.nl/blog/2021/02/09/getting-an-rohde-schwarz-amiq-up-and-running/)
* [zw-ix has a blog - Connecting a Rohde Schwarz AMIQ to a SMIQ04](https://zw-ix.nl/blog/2021/02/09/494/)

* [Bosco tweets](https://x.com/BoscoMac/status/1860000781128380629)


**Recapping**

* [Choosing Capacitors to Recap Old Electronics](https://www.youtube.com/watch?app=desktop&v=6PKaj9-1xIs&t=0s)
* [Six Common Mistakes Made When Recapping Vintage Electronics](https://www.youtube.com/watch?v=BeDKwi-GJRI)

**Related content**

* [The Signal Path - Teardown, Repair & Analysis of a Rohde & Schwarz AFQ100A I/Q (ARB) Modulation Generator](https://www.youtube.com/watch?v=6aRZGOcdGUE)
* [Analog Devices - Optimization of EVM Performance in IQ Modulators](https://www.analog.com/en/resources/technical-articles/optimization-of-evm-performance-in-iq-modulators.html)

    Uses an AMIQ in the test setup


