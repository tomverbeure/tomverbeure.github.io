---
layout: post
title: Rohde & Schwarz AMIQ Teardown and Repair 
date:   2024-11-26 00:00:00 -1000
categories:
---

* TOC
{:toc}

# Introduction

Every few months, a local company auctions off all kinds of lab, production and test equipment. 
I shouldn't be subscribed to their email list but I am, and that another way to end up with more
stuff that I don't really need.

During a recent auction, I got my hands on a Rohde & Schwarz AMIQ, an I/Q modulation
generator, for a grand total of $45. Add to that another 30% for the auction fee and taxes and
you're still paying much less than what others would pay for a round of golf? But instead of 
one morning, this thing has the potential to keep me busy for many weekends, so what a deal! 

[![AMIQ frontside view](/assets/amiq/amiq_frontside.jpg)](/assets/amiq/amiq_frontside.jpg)
*(Click to enlarge)*

A few days after "winning" the auction, I drove to a dark dungeon of a warehouse in San Jose
to pick up the loot.

The AMIQ has a power on/off button and 3 LEDs and that's in terms of user interface.
There are no dials, there's no display. So without any other options, I simply powered it up
and I was immediately greeted by the ominous clicking of a spinning disk hard drive. I was right: 
this thing would keep me entertained for at least little bit!

[![AMIQ backside view](/assets/amiq/amiq_backside.jpg)](/assets/amiq/amiq_backside.jpg)
*(Click to enlarge)*

It took a significant amount of effort to restore the machine back to its working state. I'll
write about that in a future blog post, but let's start with an overview of the functionality 
and a teardown of the R&S AMIQ.

*AMIQ prices on eBay vary wildly, from $129 to $2600 at the time of writing this. If even you
get one of the higher price, you should expect to get a unit that's close to failing due to
leaking capacitors and a flaky harddrive!*

# The Rohde & Schwarz AMIQ Modulation Generator

Reduced to an elevator sales pitch, the AMIQ is *a 2-channel arbitrary waveform generator (AWG) 
with a deep sample buffer*. That's it!

It has a sample streaming buffer that feeds a 2 14-bit DACs at a sample rate of up to 105MHz. 
Two output channels I and Q will typically contain quadrature modulation signals that are sent 
to an RF vector signal generator such as a Rohde & Schwarz SMIQ for the actual high-frequency 
modulation. In a typical setup, the AMIQ is used to generate the baseband modulated signal and 
the SMIQ shifts the baseband signal to an RF frequency.

![WinIQSIM - AMIQ - SMIQ setup](/assets/amiq/amiq_smiq_setup.png)

Since the AMIQ has no user interface, the waveform data is provided by some external control
device. This could be a PC that runs R&S WinIQSim software or even a SMIQ because it has the ability 
to control an AMIQ. You can also create your own waveforms and upload them via floppy disk, GPIB
or an RS-232 interface using 
[SCPI control commands](/2020/06/07/Making-Sense-of-Test-and-Measurement-Protocols.html#scpi---the-universal-command-language).

Figure 4-1 of the [AMIQ Operating Manual](/assets/amiq/AMIQ_OperatingManual_en_08.pdf) has a
simplified block diagram. It is pretty straightforward and similar to the one of my
[HP 33120A function generator](/2023/01/02/HP33120A-Repair-Shutting-Down-the-Eye-of-Sauron.html#a-walk-through-the-block-diagram):

[![AMIQ block diagram](/assets/amiq/amiq_block_diagram.png)](/assets/amiq/amiq_block_diagram.png)
*(Click to enlarge)*

On the left are 2 blocks that are shared:

* a clock synthesizer 
* waveform memory

And then for each channel:

* 14-bit D/A converter
* analog filters
* output section with amplifier/attenuator
* differential analog output driver (AMIQ-B2 option)

The major blocks are surrounded by a large amount of DACs that are used to control everything from
the tuning input of local 10MHz clock oscillator, gain and offset of output signals, clock skew 
between I and Q signal and much more.

You could do all of this with a modern SDR setup, except that the specifications of the AMIQ units
are dialed up a notch. Both channels are completely symmetrical to avoid modulation errors at the
source. If there's a need to compensate for small delay differences in, for example, the external 
cables, you can compensate for that by changing the skew between clocks of the output DACs with a 
precision of 10ps. Similarly, the sample frequency can be programmed with 32-bit precision.

[![Backside speciality connectors](/assets/amiq/backside_connectors.jpg)](/assets/amiq/backside_connectors.jpg)
*(Click to enlarge)*

In addition to the main I/Q outputs at the front, there are a bunch of secondary input and output signals: 

* 10MHz reference input and output
* sample clock
* trigger input
* marker output
* external filter loopback output and input
* bit error rate measurement (BER) connector (AMIQ-B1 option)
* parallel interface with the digital value of the samples that are sent to the DAC (front panel, AMIQ-B3 option)

[![Backside PC connectors](/assets/amiq/backside_pc_connectors.jpg)](/assets/amiq/backside_pc_connectors.jpg)
*(Click to enlarge)*

Above those speciality inputs and outputs there's the obligatory GPIB connectors and a bunch of generic ones 
that look suspiciously like this you'd find on an early century PC:

* PS/2 keyboard and mouse
* Parallel port
* RS232
* USB

There are 3 different AMIQ versions:

* 1110.2003.02: 4M samples 
* 1110.2003.03: 4M samples
* 1110.2003.04: 16M samples

Mine is an AMIQ-04.

# Analog Signal Generation Method and DAC Sample Clock

In the HP 33120A the DAC has a fixed 40 MHz clock. There's a 16 kB waveform RAM that contains, say, one quarter
period of a 100 Hz sine. If you want to send out a sine wave of 200 Hz, instead of sequentially stepping through
all the addresses of the waveform RAM, you just skip every other address. One of the benefits of this kind
of generation scheme is that you can make do a fixed frequency analog anti-aliasing filter: the Nyquist frequency
is fixed at 20 MHz.

A major disadvantage, however, is that even if the output signal has a bandwidth of only 1MHz, you still need to 
feed the DAC at the fixec clock rate. You could insert an upsampling digital filter between the waveform memory and 
the DAC, but that require significant mathematical DSP fire power, or you'd have to increase the depth of the
waveform memory.

For an arbitrary waveform generator, it makes more sense to run the DAC at whichever clock speed is
sufficient to meet the Nyquist requirement and provide a number of different filtering options. The AMIQ has 4 options:
no filter, a 25 MHz, a 2.5 MHz or an external filter.

The DAC sample clock range is huge, from 10 Hz all the way to 105 MHz, though specifications are only guaranteed up 
to 100 MHz. According to the data sheet, the clock frequency resolution has be set with a precision of 10^-7.

# WinIQSim Software

While it is possible to control the AMIQ over RS-232 or GPIB with your own software, you'd have
a hard time matching WinIQSim in terms of features. 

[![WinIQSim Main Multi-Carrier window](/assets/amiq/AMIQ_Main_Multi_Carrier_window.png)](/assets/amiq/AMIQ_Main_Multi_Carrier_window.png)
*(Click to enlarge)*


With WinIQSim, you can select one of the popular communication protocols from the late nineties and
early 2000s, fill in digital framing data, apply all kinds of distortions and interferences, 
compute the I and Q waveforms and send it to the AMIQ. 

[![WinIQSim FFT Magnitude plot window](/assets/amiq/AMIQ_Graphics_window.png)](/assets/amiq/AMIQ_Graphics_window.png)

Some of the supported formats include CDMA2000, 802.11a WLAN, TD-SCDMA and more. But you don't have 
to use these official protocols, WinIQSim supports any kind of FSK, QPSK, QAM or other common modulation 
method.

You need a license for some of the communication protocols. The license is linked to the AMIQ device,
not the PC, but the license check is pretty naive, and while I haven't tried it... yet, the EEVblog forum 
has discussions about how to enable features yourself. My device only came with a license for IS-95 CDMA. 

# Inside the AMIQ

It's trivial to open up an AMIQ: after removing the 4 feet in the back with a regular
Philips screwdriver, you can simply slide off the outer case.

It has 2 major subsystems:

* the top contains all the components of a standard PC

  [![AMIQ top inside view - PC motherboard](/assets/amiq/amiq_pc_motherboard_side.jpg)](/assets/amiq/amiq_pc_motherboard_side.jpg)
  *(Click to enlarge)*


* the bottom has a signal generation PCB

  [![AMIQ signal generation side](/assets/amiq/amiq_siggen_side.jpg)](/assets/amiq/amiq_siggen_side.jpg)
  *(Click to enlarge)*

  It looks incredibly clean and well layed out and I love how they printed the names of different
  sections on the metal gray shielding plates.


# The Signal Generation PCB

Let's remove the shielding plates to see what's underneath. I had to drill out one of the screws that attach
the plates because the head was stripped. (Did somebody before me already try to repair it?)

[![AMIQ signal generation board](/assets/amiq/amiq_siggen_uncovered.jpg)](/assets/amiq/amiq_siggen_uncovered.jpg)
*(Click to enlarge)*

The bottom half left and right sections are perfectly symmetrical, as one would expect for a device that has the
ability to tune skew mismatches with a 10 ps precision.

Annotated, it looks like this:

[![AMIQ signal generation annotated](/assets/amiq/amiq_siggen_annotated.jpg)](/assets/amiq/amiq_siggen_annotated.jpg)
*(Click to enlarge)*

Rohde & Schwarz recently made the terrible decision to lock all their software and manuals behind an approval-only 
corporate log-in wall, but luckily some of the most important AMIQ assets can be found online elsewhere, including 
the operating manual and a service manual contains the full schematic!

Let's dig a bit deeper into the various aspects of the design.

**Fantastic Schematics**

Before digging in for real, for a word about the schematic: they are fantastic.

Each sub-system has a block diagram that is already pretty detailed, with signal names
that match the schematic and test points. There are plenty of annotations to indicate the voltage or
frequency range.

[![Block diagram example](/assets/amiq/block_diagram.png)](/assets/amiq/block_diagram.png)
<center>Schematic page 5 <i>(Click to enlarge)</i></center><br/>

All signals that also exist on other pages are fully referenced. Look at the `SYN_OUT_CLK` signal below:

[![Schematic signal referencees](/assets/amiq/schematic_signal_references.png)](/assets/amiq/schematic_signal_references.png)
<center>Schematic page 10 <i>(Click to enlarge)</i></center><br/>

The signal is also used on page 6, coordinate 1D and 7B and page 22, coordinate 8A. How cool is that?

**Signal path test points**

One of the awesome features of the PCB is the generous amount of test points. We're not
just talking PCB test point against which you can hold your oscilloscope probe or even header
pins, though there are plenty of those too, but full on SMB connectors.

![AMIQ test connectors](/assets/amiq/amiq_test_connectors.jpg)

**Internal Reference Clock Generation**

Like all professional test and measurement equipment, the AMIQ uses a 10MHz reference clock that
can come from outside or it can be generated locally with a 10MHz crystal. It's common for high-end equipment
to have an oven controlled crystal oscillator (OCXO), but in this case we have to make do with a lower spec'ed
temperature controlled one (TCXO), a [Milliren Technologies 453-0210](/assets/amiq/milliren_txco_400_series.jpg).

![Reference clock generation PCB](/assets/amiq/ref_clock_generation_pcb.jpg)

If we look at the larger reference clock generation block diagram, we can see something slightly unusual: instead
of selecting between the internal TCXO output or the external reference clock input, the internal reference
clock always comes from the TCXO (green). 

[![Reference clock block diagram](/assets/amiq/reference_clock_diagram.png)](/assets/amiq/reference_clock_diagram.png)
<center>Schematic page 5 <i>(Click to enlarge)</i></center><br/>

When the internal clock is selected, the TCXO output frequency can be tuned with an analog signal that comes from
the `VTXCO TUNE` DAC (blue), but when the external reference input is active, TCXO is phase locked to the
external clock. You can see the phase comperator and low pass filter in red.

The reason for using a PLL with the internal TCXO as the voltage controlled oscillator is probably to ensure
that the generated reference clock has the phase noise of the TCXO while tracking the frequency of the
external reference clock: a PLL acts as a low-pass filter to the reference clock and as a high-pass filter
to the VCO. If the TCXO has a better high frequency phase noise than the external reference clock, that makes 
sense. 
*This is really out of my wheelhouse, so take all of this with a grain of salt...*

`SYN_REF` is the output of the internal reference clock generation unit.

**DAC Clock Synthesizer**

The clock synthesizer creates a highly programmable DAC clock from the internal reference clock. It should
come as no surprise that this clock is generated by a PLL as well.

[![Clock synthesizer block diagram](/assets/amiq/clock_synthesizer.png)](/assets/amiq/clock_synthesizer.png)
<center>Schematic page 5 <i>(Click to enlarge)</i></center><br/>

There are two speciality components in the clock generation path:

* a [Mini-Circuits JTOS-200 VCO](/assets/amiq/JTOS-200.pdf)
* an [AD9850 DDS Synthesizer](https://www.analog.com/media/en/technical-documentation/data-sheets/ad9850.pdf)

[![Clock synthesizer PCB](/assets/amiq/clock_synthesizer_pcb.jpg)](/assets/amiq/clock_synthesizer_pcb.jpg)
*(Click to enlarge)*

The VCO has an operating frequency between 100 and 200 MHz. I don't know enough about VCOs to give meaningful
commentary about the specifications, but based on some comparisons of similar components on Digikey, such
as this [FMVC11009](https://www.digikey.com/en/products/detail/fairview-microwave/FMVC11009/22222673), 
it's safe to assume that it's an expensive and high quality component.

The AD9850 is located in the feedback path of the PLL where it acts as an feedback divider with a 
precision of 32 bits. 

![AD9850 block diagram](/assets/amiq/ad9850_block_diagram.png)

The signal flow inside the AD9850 is interesting:

![AD9850 signal flow](/assets/amiq/ad9850_signal_flow.png)

It works as follows:

* each clock cycle, the phase of a [numerical controlled oscillator (NCO)](https://en.wikipedia.org/wiki/Numerically_controlled_oscillator)
  accumulates with the programmable 32-bit increment.
* the upper bits of the phase accumulator serve as the address of a sine waveform table.
* a 10-bit DAC converts the digital sine wave for analog.
* the analog signal is sent through an external low-pass filter.
* the output of the low-pass filter goes back into the AD9850 and through a comparator to generate a digital output clock.

This thing has its own programmable signal generator! But why the roundtrip from
digital to analog back to digital? In theory, the MSB of the NCO could be used as output clock
of the clock generator.

The problem is that in such a configuration, the length of each clock period toggles between
N and N+1 clock cycles, with a ratio so that the average ends up with the right fraction. 
But this creates major spurs in the frequency spectrum of the generated clock. 

When fed into the phase comparator of a PLL, these frequency spurs can eventually show up as 
jitter at the output of the PLL.

By converting the signal to analog and using a low pass filter, the spurs can be filtered
away. The combination of a low pass filter and a comparator acts as an interpolator: the edges of
the generated clock fall somewhere in between N and N+1.

[![DDS oscillator schematic](/assets/amiq/dds_oscillator.png)](/assets/amiq/dds_oscillator.png)
<center>Schematic page 21 <i>(Click to enlarge)</i></center><br/>

The AD9850 is designed as generic clock synthesis IC that can be used in applications that aren't
PLL related. This limits the kind of techniques that can be used to filter out spurs and requires
the analog filters with a pretty high order. The steepness of the low pass filter also depends
on the ratio between the input and the output clock: the lower the ratio, the steeper the filter.
There are a bunch of binary clock dividers that make it hard to know the exact ratio, but if the 
output of the VCO is 100 MHz and the input 10 MHz or less, there is a 10:1 ratio. The AMIQ has a 
7th order low pass filter.

I ran a quick simulation in LTspice to check the behavior.

![Filter schematic in LTspice](/assets/amiq/filter_spice_schematic.png)

The filter has a cut-off frequency of around 13 MHz:

![Filter frequench plot in LTspice](/assets/amiq/filter_spice_frequency_plot.png)

In modern fractional PLLs, instead of using a regular DAC, one could use a high-order sigma-delta 
unit to create a pulse density modulated output with the noise pushed to higher frequencies and
a low pass filter that can be less aggressive.

There's a plenty of literature online about DDS clock generators, some of which I've listed in 
the references at the bottom, but the 
[datasheet of the AD9850](https://www.analog.com/media/en/technical-documentation/data-sheets/ad9850.pdf)
itself is a good start.

**Efficient Distribution of Configuration Signals**

The AMIQ signal board has hundreds of configuration bits: there are the obvious enable/disable or selection bits,
such as those to select between different output filters, but the lion's share are used to set the output value
of many 12-bit DACs.

Instead of using parallel busses that converage at an FPGA, the AMIQ has a serial configuration scan chain.
Discrete 8-bit [74HCT4094 shift-and-store registers](https://assets.nexperia.com/documents/data-sheet/74HC_HCT4094.pdf) 
are located all over the design for the digital configuration bits. 
The [DAC8134 devices](https://www.analog.com/media/en/technical-documentation/data-sheets/DAC8143.pdf) 
have their own built-in shift register and are part of the same scan chain.

[![Configuration scan chain](/assets/amiq/config_scan_chain.png)](/assets/amiq/config_scan_chain.png)
<center>Schematic page 19 <i>(Click to enlarge)</i></center><br/>

The schematic above is an example of that. The red scan chain data input goes through the `VTCXO_TUNE` DAC, then 
the 74HCT4094 after which it exist to some other page of the schematic.


# The PC System


  We can see the motherboard, power supply, floppy drive and hard drive. On the
  bottom right, an ISA plug-in card connects the motherboard to the signal generation
  PCB.

The signal generation part is for another time, let's start with the motherboard
because there's almost certainly a bunch of work to do there.


The motherboard is an MSI MS-5169. YOu can find a lot of details here, but it's an pretty
standard late nineties affair with support for a large selection of CPU from Intel, AMD and
Winchip, SDR UDIMM RAM or 72-pin EDO RAM, 4 PCI, 1 AGP and 2 16 slots, floppy and IDE interface
and the usually assortment of smaller interfaces for mouse, keyboard serial port etc.

It was produced in late nineties and early 2000s, which is right around the time of the
electrolythic capacitor disaster that hit pretty much all electronics back and, boy does
mine suffer from it! Have a look at some of the pictures below:

XXXXX

There are around 30 electrolythic caps on the mother board and while it's not possible to
visually determine if the smaller ones have issues, all the larger ones have traces of rust
at the top. I didn't see any signs of leaks, which is great because the fluid inside the cap
is highly corrosive. It's much easier to replace a capacitor than to reconstruct hairline
PCB traces that have melted away.

Conventional wisdom says that when faulty capacitors are suspected, you should first replace
all of them before powering on the PC. I was impatient and powered it on anyway. I was immediately
greeted with a bunch of beeps,  good, because that means that there's still some life in the
motherboard, and the ominous clicking sound of a failed hard drive.

# Recapping the motherboard

Recapping is a pretty common process and you can find plenty of videos on Youtube about it.

But what's usually missing is a list of all the caps that must be replaced. Here's the
list of what's needed for the MS-I5619:

When making a purchase list of replacements caps on Mouser, I didn't pay close attention to the
equivalent series resistance (ESR) of the new caps. When used as part of a switch mode power
supply, some capacitors will continuously be exposed to high-frequency charge-discharge cycles.
In such a case, a high series resistance will result in power being wasted inside cap, thus
reducing power efficiency and higher temperature which will ultimately reduce the life of the new
caps as well.

Low ESR capacitors are only a bit more expensive than general purpose ones, so it's not really worth
cheaping out on them. On the other hand, how long will you really use this motherboard anyway?

For the recap itself, I used my brand new XXXXX desoldering station, a Xmas gift from my wife.
She knows me well!

This was my first recap ever and even 25 year old motherboards are already sufficiently advanced
to make it a delicate operation.

Here are some random notes about techniques that I learned along the way:

In an ideal world, you'll be able to suck enough solder out of the through-hole so that you
can simply insert a replacement cap back and and solder it. In practice, that rarely happens.
Larger caps such as the 1000uF and 1500uF ones have thicker leads and a larger through-hole
diameter. For those, there is a decent chances that at least one of the hole will free up. I
never had a case where both holes were unclogged.

One of the nice benefits of the heated desoldering pump was that the tip is hollow so it will
immediately warm up the solder around the whole lead, instead of heating it up at one side
only.

It helps to wiggle around the hot tip in circles to loosen up the solder all around.

Putting some amount of force on the cap that needs to be removed is inevitable, but you can't
overdo it because you might strips out the copper lining of the hole itself.

First adding instead of immediately removing solder can work wonders. The extra solder can
increase the contact surface between the solder and the soldering iron tip and make the solder
heat up much easier.

For small capacitors with small lead spacing such as the 10uF and 100uF caps, the desoldering
pump wasn't very useful. I had best results but adding enough new solder so that it bridged both
leads, and then after heating it up more, then cap would often just fall out. Gravity for the win!

There can be a large variance in the effort required to remove a capacitor. Some could be removed
with almost no effort. Others took ages. It depends on the amount of ground planes and other elements
that are good at whisking away heat: you just can't heat the thing up fast enough.

One option that I didn't try is to cut away the capacitor with nose pliers so that only 2 lead
stubs are left. This way, instead of have to extract 2 leads together, you can remove one at a
time which is much easier.

**Inserting new caps**

When you can't unclog a solder hole, inserting a new cap won't be as easy. Here are some techniques that
I used.

I shorten the leads first and make one lead around 2mm shorter than the other. The longest lead is
obviously the one I want to put in place first. When there are no nearby obstacles that limit my
ability to maneuver the cap, I make the longest lead around 5mm and the shorter one around 3mm. Shorter
leads reduce that chance that they will buckle when you're putting a bit of pressure on them to get them
through the hole.

If there are nearby connectors or other components, I makes the leads as long as they need to be so that
the cap rises above its surroudings before it's inside the hole. The chance to buckle a lead is higher
now, but at least your fingers will have something to grip on.

You'll be holding 3 things at the same time: the soldering iron on one side of the PCB, the PCB itslef and
the new cap on the other side, which is a little bit of a challenge with only 2 hands.

Since you'll be looking on the side of the soldering iron, you don't have the luxury to monitor the placement
of the cap. For this reason, you need to make sure that the residual solder after removing the old cap doesn't
bulge but is slightly sunken into the hold. This way, when you place the longer lead of the cap on the PCB,
it will stay there and not glide off. Use soldering wick on the component side of the PCB to remove excess
solder if the solder is bulging out of the hole.

Here's an example of that: the holes of the left cap have already been wicked and are indented. Those of the
right cap have solder bulging out.

With the longer lead positions inside the indented hole, it's time to heat up that hole from the other side.
An indented hole usually means that there's not a lot of solder in the full at all, so I use a fine tipped
soldering iron and poke it perpendicalar into the hole to reach the solder. Soon the lead will shoot
through the hole. This is the point where I'll add more solder to this hole so that it's easier to
heat up the solder.

You now need to get the second lead in. If the distance between the 2 holes is small enough, you can heat
the solder of both holes at the same time but squeezing your iron between the 2 holes, just like you could
when using the gravity method to remove small caps.

If that's not possible, you'll have to alternate between the two leads and gradually work the capacitor
into its position.

# Disassembly

* Remove 4 back feet
* Slide case away
* Cut zip ties
* Unplug 2 flat cables
* Unplug power cable
* Unscrew 4 screws of CPU fan
    * 12V neolec. Screw holes: 33x33mm
* Unplug memory stick: 8x 48LC8M8A2 8MByte per chip -> 64MByte total
* Loosen 4 screws for the motherboard back holding bracket and slide it back
* Unplug speaker cable
* Remove 3 motherboard holding screws
* Remove 6 hex screws for the parallel port, RS232 and X13 connector
    * The motherboard is now loose.
    * It's an [MSI MS5179](https://groups.io/g/Rohde-and-Schwarz/topic/r_s_amiq_generator_need/52310294)
    * [The Retro Web](https://theretroweb.com/motherboards/s/msi-ms-5169-al9)
    * size: 300x
* Lift the motherboard from the left
* Unplug the 2 flat cables on the right
* Unplug right cable with blue and red wires
* Remove heat sink from CPU: push down on the metal clip close to the DRAM slots
    * Remove CPU
* Remove ISA extension slot

Removing HD:
* Remove power cable attachment screw
* Remove 2 screws on aluminum HDD holding plate
* Disconnect cables
* Remove 2 HD attachment screws
* Slide out HD
* Backup HD:
* `sudo apt install gddrescue`
* `ddrescue /dev/<src device> amiq-backup.img`

* Take motherboard out
* Plug in PCI card -> boot screen
* Replace CR2032

* Disk image through http://www.ko4bb.com/getsimple/index.php?id=manuals
* Compact Flash

```
tom@zen:~/projects/tomverbeure.github.io/assets/amiq$ sudo ddrescue -f amiq_hdd.img /dev/sda log
GNU ddrescue 1.23
Press Ctrl-C to interrupt
     ipos:    3253 MB, non-trimmed:        0 B,  current rate:   1003 MB/s
     opos:    3253 MB, non-scraped:        0 B,  average rate:   1084 MB/s
non-tried:        0 B,  bad-sector:        0 B,    error rate:       0 B/s
  rescued:    3253 MB,   bad areas:        0,        run time:          2s
pct rescued:  100.00%, read errors:        0,  remaining time:         n/a
                              time since last successful read:         n/a
Finished                                     
```

Took around 8 minutes even if 'Finished' showed up immediately.



# Capacitors

Caps: they're all aluminum electrolytic radial ones.

* scan front to back - left to right

* 1x 470uF/16V - USB connectors 
* 3x 10uF/25V (tiny)
* 2x 1500uF/10V
* 4x 1000uF/6.3V
* 1x 1000uF/6.3V
* 1x 470uF/16V

* 1x 10uF/25V (tiny)
* 1x 470uF/16V
* 4x 1000uF/6.3V
* 1x 100uF/16V

* 3x 1000uF/6.3V
* 1x 10uF/25V
* 1x 100uF/16V

* 1x 1000uF/10V
* 1x 100uF/16V

* 1x 470uF/16V
* 1x 100uF/16V

* 2x 100uF/16V

* 1x 470uF/16V
* 2x 10uF/25V

* 2x 47uF/25V
* 1x 100uF/16V

Summary:

* 5x 470uF/16V      - 8.3mm diam    - 3.2mm spacing
* 2x 1500uF/10V     - 10.2mm        - 5.5mm
* 10x 1000uF/6.3V   - 8.3mm         - 3.6mm
* 7x 10uF/25V       - 4.2mm         - 2mm
* 7x 100uF/16V      - 5.3mm         - 2mm
* 2x 47uF/25V       - 5.3mm         - 2mm

# Booting up

* Plug in VGA GPU
    * ATI Rage XL 8MB PCI
    * $20.72 on eBay
* [PCI riser card](https://www.mini-box.com/s.nl/it.A/id.289/.f?sc=8&category=1549)
    * $3

* RAM test first
* Use keyboard with PS/2
* DEL key due RAM test to enter BIOS setup screen

# WinIQSim

* Start software
* ARB -> Select Target ARB ... -> AMIQ03
* ARB -> AMIQ -> AMIQ Interface and Transmission Options -> RS 232 -> Default baud rate: 115200
* ARB -> AMIQ -> Remote Control and BERT..

  This will try to access remote. See remote control window.

  * Test and Adjustment
  * Selftest
  * Send command: doesn't work

* quit WinIQSinm
* Putty
  * serial, com3, 115200
  * Terminal: 
    * Local echo: force on
  * Open
  * `*IDN?` -> ...
  
```
*RST
CLOCK 100MHz
ARM
TRIG
SClock EXTFAst   <- switches to external clock input
```

* Calibration of level and offset for I and Q

```
*RST
CAL:ALL?
```

Takes about 30s. Should return 0 if no error.

* Won't work when PCI VGA is not plugged in

  * This is because Primary Display is set to VGA/EGA in "Advanced CMOD Setup"
  * Set to "Absent"
  * After this, VGA card will still work when plugged in, but only in PCI slot
    that is closest to the CPU

* After bootup: "Error: 243, "AMIQ variant check failed;Board-ID 155: Bit:24/24 Vers 05/06"

# EEPROM

```
tom@zen:~/projects/tomverbeure.github.io/assets/amiq$ ./eeprom.py EEPROM_AMIQ02.BIN 
XOR result of all bytes in the file 'EEPROM_AMIQ02.BIN': 0xa5
tom@zen:~/projects/tomverbeure.github.io/assets/amiq$ ./eeprom.py EEPROM_AMIQ04.BIN 
XOR result of all bytes in the file 'EEPROM_AMIQ04.BIN': 0xa5
tom@zen:~/projects/tomverbeure.github.io/assets/amiq$ ./eeprom.py EEPROM_AMIQ04b.BIN 
XOR result of all bytes in the file 'EEPROM_AMIQ04b.BIN': 0xa5
```

```
tom@zen:~/projects/tomverbeure.github.io/assets/amiq$ xxd EEPROM_AMIQ02.BIN 
00000000: c200 0300 cc00 3832 3932 3933 2f30 3334  ......829293/034
00000010: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000020: 0000 0000 0000 0000 0000 0000 0000 f03f  ...............?
00000030: a508 0008 5708 7e08 e907 3708 3c08 6408  ....W.~...7.<.d.
00000040: ce07 1c08 4007 4607 4c07 5107 5507 5807  ....@.F.L.Q.U.X.
00000050: 5c07 5e07 6007 6007 6107 6007 6007 5e07  \.^.`.`.a.`.`.^.
00000060: 5b07 5807 5507 5007 4c07 4607 4007 9109  [.X.U.P.L.F.@...
00000070: 7a09 7009 af08 440f 6608 1408 c007 e400  z.p...D.f.......
00000080: a207 b107 b407 c707 b607 c407 c807 da07  ................
00000090: fe06 0507 0b07 1007 1407 1807 1c07 1e07  ................
000000a0: 2007 2007 2107 2007 1f07 1d07 1a07 1707   . .!. .........
000000b0: 1407 0f07 0a07 0407 fd06 7209 5809 5109  ..........r.X.Q.
000000c0: 8e08 420f 6c08 1a08 c807 ec00            ..B.l.......
tom@zen:~/projects/tomverbeure.github.io/assets/amiq$ xxd EEPROM_AMIQ04.BIN 
00000000: 8f00 0300 cc00 3833 3832 3636 2f30 3234  ......838266/024
00000010: 0000 0000 0100 0000 0000 0000 0000 0000  ................
00000020: 0000 0000 0000 0000 7e42 2c51 ac09 f03f  ........~B,Q...?
00000030: d705 0008 5d08 8508 7308 0008 6208 7f08  ....]...s...b...
00000040: 7608 0008 8206 8606 8a06 8e06 9106 9306  v...............
00000050: 9506 9606 9806 9806 9806 9806 9606 9506  ................
00000060: 9406 9206 8f06 8c06 8806 8406 8006 a609  ................
00000070: 9e09 8609 0008 8a0f 6c08 1608 c007 a000  ........l.......
00000080: 8708 1009 6508 0008 5208 d208 3208 0008  ....e...R...2...
00000090: 5606 5706 5806 5906 5a06 5a06 5b06 5b06  V.W.X.Y.Z.Z.[.[.
000000a0: 5c06 5c06 5c06 5b06 5c06 5a06 5a06 5a06  \.\.\.[.\.Z.Z.Z.
000000b0: 5a06 5906 5806 5806 5706 d409 cc09 b409  Z.Y.X.X.W.......
000000c0: 0008 880f 6808 1208 bc07 9e00            ....h.......
tom@zen:~/projects/tomverbeure.github.io/assets/amiq$ xxd EEPROM_AMIQ04b.BIN 
00000000: 3100 0300 cc00 3833 3832 3636 2f30 3234  1.....838266/024
00000010: 0000 0000 0100 0000 0000 0000 0000 0000  ................
00000020: 0000 0000 0000 0000 7e42 2c51 ac09 f03f  ........~B,Q...?
00000030: d705 0008 5d08 8508 7308 0008 6208 8008  ....]...s...b...
00000040: 7808 0008 7c06 8106 8606 8806 8c06 8e06  x...|...........
00000050: 9006 9206 9306 9406 9406 9306 9206 9006  ................
00000060: 8f06 8c06 8a06 8806 8406 8006 7c06 a609  ............|...
00000070: 9f09 8609 0008 8a0f 6a08 1408 be07 9f00  ........j.......
00000080: 8508 1109 6408 0008 5208 d308 3008 0008  ....d...R...0...
00000090: 5606 5606 5806 5806 5806 5a06 5a06 5a06  V.V.X.X.X.Z.Z.Z.
000000a0: 5a06 5a06 5a06 5a06 5a06 5906 5806 5806  Z.Z.Z.Z.Z.Y.X.X.
000000b0: 5806 5606 5606 5606 5406 d409 cb09 b409  X.V.V.V.T.......
000000c0: 0008 880f 6808 1208 bc07 9e00            ....h.......
```


# References

**Rohde & Schwarz documents**

* [R&S AMIQ Operating Manual](/assets/amiq/AMIQ_OperatingManual_en_08.pdf)
* [R&S AMIQ Service Manual with schematic](/assets/amiq/Rohde_Schwarz_AMIQ_Service_Manual_with_schematics.pdf)
* [R&S AMIQ Overview](/assets/amiq/AMIQ_overview.PDF)
* [R&S AMIQ Datasheet](/assets/amiq/Rohde-Schwarz-AMIQ04-Datasheet.pdf)

* [R&S Floppy Disk Control of the I/Q Modulation Generator AMIQ](/assets/amiq/amiq_floppy_disc_control.pdf)
* [R&S Software WinIQSIM for Calculating I/Q Signals for Modulation Generator R&S AMIQ](/assets/amiq/Software Manual WinIQSIM - ES Documentation.pdf)
* [R&S Creating Test Signals for Bluetooth with AMIQ / WinIQSIM and SMIQ](/assets/amiq/R&S - Creating Test Signals for Bluetooth with AMIQ.pdf)
* [R&S WCDMA Signal Generator Solutions](/assets/amiq/R&S - WCDMA Signal Generator Solutions.pdf)
* [R&S Golden devices: ideal path or detour?](/assets/amiq/R&S Golden devices - ideal path or detour.pdf)
* [R&S Demonstration of BER Test with AMIQ controlled by WinIQSIM](/assets/amiq/R&S - Demonstration of BER Test with AMIQ controlled by WinIQSIM.pdf)

**Other AMIQ content on the web**

* [Lost Manual - Rohde & Schwarz](https://www.lost-manuals.com/en/manufacturer/rohde-schwarz)
* [R&S Groups.io AMIQ repair thread](https://groups.io/g/Rohde-and-Schwarz/topic/r_s_amiq_generator_need/52310294)
* [EEVBlog repair discussion](https://www.eevblog.com/forum/testgear/harddisk-image-for-rs-amiq-generator/)
* [EEVBlog AMIQ license key comment](https://www.eevblog.com/forum/testgear/enabling-options-for-rs-test-equipment/msg3468382/#msg3468382)
* [EEVBlog AMIQ license key comment](https://www.eevblog.com/forum/testgear/enabling-options-for-rs-test-equipment/msg4626139/#msg4626139)
* [EEVBlog AMIQ + SFQ as vector signal generator](https://www.eevblog.com/forum/testgear/rs-smiq-as-a-replacement-for-a-general-signal-generator/msg5400308/#msg5400308)
* [How to get error out of AMIQ?](https://forums.ni.com/t5/UVLabVIEW/How-to-get-errors-form-R-amp-S-AMIQ/td-p/3639064)

* [zw-ix has a blog - Getting an Rohde Schwarz AMIQ up and running](https://zw-ix.nl/blog/2021/02/09/getting-an-rohde-schwarz-amiq-up-and-running/)
* [zw-ix has a blog - Connecting a Rohde Schwarz AMIQ to a SMIQ04](https://zw-ix.nl/blog/2021/02/09/494/)

* [Bosco tweets](https://x.com/BoscoMac/status/1860000781128380629)

** DDS Clock Synthesis**

* [MT-085 Tutorial: Fundamentals of Direct Digital Synthesis (DDS)](https://www.analog.com/media/en/training-seminars/tutorials/MT-085.pdf)
* [How to Predict the Frequency and Magnitude of the Primary Phase Truncation Spur in the Output Spectrum of a Direct Digital Synthesizer (DDS)](https://www.analog.com/media/en/technical-documentation/app-notes/an-1396.pdf)

**Recapping**

* [Choosing Capacitors to Recap Old Electronics](https://www.youtube.com/watch?app=desktop&v=6PKaj9-1xIs&t=0s)
* [Six Common Mistakes Made When Recapping Vintage Electronics](https://www.youtube.com/watch?v=BeDKwi-GJRI)

**Related content**

* [The Signal Path - Teardown, Repair & Analysis of a Rohde & Schwarz AFQ100A I/Q (ARB) Modulation Generator](https://www.youtube.com/watch?v=6aRZGOcdGUE)
* [Analog Devices - Optimization of EVM Performance in IQ Modulators](https://www.analog.com/en/resources/technical-articles/optimization-of-evm-performance-in-iq-modulators.html)

    Uses an AMIQ in the test setup


# HD repair

* [Head Stack Replacement: Questions and Answers](https://hddguru.com/articles/2006.02.17-Changing-headstack-Q-and-A/)
* [HDDSurgery: HDDS HGST 2.5â€ Ramp Set](https://hddsurgery.com/data-recovery-tools/hdds-hgst-2-5-inch-ramp-set)
* [DonorDrives](https://www.donordrives.com/)
* [Clicking Noise? Causes and solutions?](https://forum.hddguru.com/viewtopic.php?f=16&t=7457)
