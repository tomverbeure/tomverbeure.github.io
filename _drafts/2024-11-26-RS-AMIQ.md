---
layout: post
title: Rohde & Schwarz AMIQ Repair
date:   2024-11-26 00:00:00 -1000
categories:
---

* TOC
{:toc}

# Introduction

Every few months, a local company auctions off all kindso of lab, production and test equipment. 
I shouldn't be subscribed to their email list, but I am, and that's how end up buying more
stuff that I don't really need.

During a recent auction, I got my hands on a Rohde & Schwarz AMIQ, an I/Q modulation
generator, for the grant total of $45. Add to that another 30% for the auction fee and taxes and
you're still paying much less than what other would pay for a round of golf? But instead of 
one morning, this thing has the potential to keep me busy for many weekend, so what a deal! 
(That's how I justify buying this kind of junk...)

A few days after 'winning' the auction, I drove to a dark dungeon of a warehouse in San Jose
to pick up the loot.

The AMIQ has a power on/off button power button and 3 LEDs and that's in terms of user interface.
There are no dials and there's no display. So without any other options, I simply powered it up
and I was immediately greeted by the ominous clicking of a hard drive. I was right: this thing
would keep me entertained for at least little bit!

[![AMIQ backside view](/assets/amiq/amiq_backside.jpg)](/assets/amiq/amiq_backside.jpg)
*(Click to enlarge)*

In this blog post, I'll go through the steps that I took to revive the unit. At its core, it's
a story of getting an old PC back to life.

# The Rohde & Schwarz AMIQ Modulation Generator

When reduce to an elevator sales pitch, the AMIQ can be described as *a sample streaming buffer that 
is connected to a 2 DAC that can run at a rate of up to 105MHz*. Or even more succinct: it's
*a 2-channel arbitrary waveform generator (AWG) with a deep sample buffer*. That's it!

The I and Q output channels of the AMIQ will typically contain quadrature modulation signals
that gets sent to a vector signal generator such as the Rohde & Schwarz SMIQ that does that actual
high-frequency modulation. In a typical setup, the AMIQ is used to generate the baseband 
modulated signal and the SMIQ shifts that baseband signal to an RF frequency.

![WinIQSIM - AMIQ - SMIQ setup](/assets/amiq/amiq_smiq_setup.png)

Since the AMIQ has no user interface, the waveform data is provided by some external control
device. This could be a PC that runs R&S WinIQSim software or even a SMIQ which has the ability to 
drive an AMIQ. You can also create your own waveforms and upload them via floppy disk, GPIB
or RS-232 that runs at 9600 baud (ouch!).

The block diagram of the AMIQ is straightforward and quite similar to the one of my
[HP 33120A function generator](/2023/01/02/HP33120A-Repair-Shutting-Down-the-Eye-of-Sauron.html#a-walk-through-the-block-diagram):

[![AMIQ block diagram](/assets/amiq/amiq_block_diagram.png)](/assets/amiq/amiq_block_diagram.png)
*(Click to enlarge)*

We can see the following major blocks:

* a clock synthesizer 
* waveform memory

For each channel: 

* 14-bit D/A converter
* analog filter
* output section with amplifier/attenuator

You could do all of this with a modern SDR setup, except that the specifications of the AMIQ units
are dialed up a notch. Both channels are completely symmetrical to avoid modulation errors at the
source. If there's a need to compensate for small delay differences in, for example, the external 
cables, you can compensate the skew between 2 channels with a precision of 10ps. Similarly, the sample 
frequency can be programmed with 32-bit accuracy.

In addition the main analog outputs, there are a bunch of other signals available on connectors
in the back and the front: the I/Q values in digital format are present on a parallel interface that
uses a SCSI compatible connector, there are trigger inputs, reference clock input and outputs,
signal markers, and there's a BER input to measure bit error rates when the unit is used in a 
feedback 


* 1110.2003.03  -> 4M samples
* 1110.2003.04  -> 16M samples
* Installed options: 
  * AMIQ-B1: BER measurement (eBay keys: S/N 1110.2003k04 Ser. 100488 - 1585539793)
  * AMIQ-B2: differential outputs
  * AMIQ-B3: digital I/Q output via 68-pin SCSI connector
  * AMIQ-K11: IS-95 CDMA (key provided or eBay keys: S/N 1110.2003k04 Ser. 100488 - 1648385996)
  * AMIQ-K12: IS-95 CDMA (eBay key: S/N 1110.2003k04 Ser. 100488 - 2030917104)

# Operating principal

From the operating manual:

> The desired information data stream (eg a
> piece of speech) is generated and a modulation mode selected. Then various
> interference and distortions (so-called impairments) are superimposed to this (ideal)
> baseband signal. Thus a long sequence of sample values is obtained, which are
> loaded into AMIQ (via floppy, IEC/IEEE bus or RS-232 interface). The sequence in
> the AMIQ memory is then output as analog I and Q signals with the aid of fast and
> accurate D/A converters. The outputs are (normally) connected to the modulation
> inputs of an I/Q modulator (eg SMIQ), which modulates the baseband signal onto the
> desired RF (Fig. 1-1).


# Disassembly

* Remove 4 back feet
* Slide case away
* Cut zip ties
* Unplug 2 flat cables
* Unplug power cable
* Unscrew 4 screws of CPU fan
    * 12V neolec. Screw holes: 33x33mm
* Unplug memory stick: 8x 48LC8M8A2 8MByte per chip -> 64MByte total
* Loosen 4 screws for the motherboard back holding bracket and slide it back
* Unplug speaker cable
* Remove 3 motherboard holding screws
* Remove 6 hex screws for the parallel port, RS232 and X13 connector
    * The motherboard is now loose.
    * It's an [MSI MS5179](https://groups.io/g/Rohde-and-Schwarz/topic/r_s_amiq_generator_need/52310294)
    * [The Retro Web](https://theretroweb.com/motherboards/s/msi-ms-5169-al9)
    * size: 300x
* Lift the motherboard from the left
* Unplug the 2 flat cables on the right
* Unplug right cable with blue and red wires
* Remove heat sink from CPU: push down on the metal clip close to the DRAM slots
    * Remove CPU
* Remove ISA extension slot

Removing HD:
* Remove power cable attachment screw
* Remove 2 screws on aluminum HDD holding plate
* Disconnect cables
* Remove 2 HD attachment screws
* Slide out HD
* Backup HD:
* `sudo apt install gddrescue`
* `dd_rescue /dev/<src device> /dev/<dest device>/images/amiq-hdd.img`

* Take motherboard out
* Plug in PCI card -> boot screen
* Replace CR2032

* Disk image through http://www.ko4bb.com/getsimple/index.php?id=manuals
* Compact Flash

```
tom@zen:~/projects/tomverbeure.github.io/assets/amiq$ sudo ddrescue -f amiq_hdd.img /dev/sda log
GNU ddrescue 1.23
Press Ctrl-C to interrupt
     ipos:    3253 MB, non-trimmed:        0 B,  current rate:   1003 MB/s
     opos:    3253 MB, non-scraped:        0 B,  average rate:   1084 MB/s
non-tried:        0 B,  bad-sector:        0 B,    error rate:       0 B/s
  rescued:    3253 MB,   bad areas:        0,        run time:          2s
pct rescued:  100.00%, read errors:        0,  remaining time:         n/a
                              time since last successful read:         n/a
Finished                                     
```

Took around 8 minutes even if 'Finished' showed up immediately.



# Capacitors

Caps: they're all aluminum electrolytic radial ones.

* scan front to back - left to right

* 1x 470uF/16V - USB connectors 
* 3x 10uF/25V (tiny)
* 2x 1500uF/10V
* 4x 1000uF/6.3V
* 1x 1000uF/6.3V
* 1x 470uF/16V

* 1x 10uF/25V (tiny)
* 1x 470uF/16V
* 4x 1000uF/6.3V
* 1x 100uF/16V

* 3x 1000uF/6.3V
* 1x 10uF/25V
* 1x 100uF/16V

* 1x 1000uF/10V
* 1x 100uF/16V

* 1x 470uF/16V
* 1x 100uF/16V

* 2x 100uF/16V

* 1x 470uF/16V
* 2x 10uF/25V

* 2x 47uF/25V
* 1x 100uF/16V

Summary:

* 5x 470uF/16V      - 8.3mm diam    - 3.2mm spacing
* 2x 1500uF/10V     - 10.2mm        - 5.5mm
* 10x 1000uF/6.3V   - 8.3mm         - 3.6mm
* 7x 10uF/25V       - 4.2mm         - 2mm
* 7x 100uF/16V      - 5.3mm         - 2mm
* 2x 47uF/25V       - 5.3mm         - 2mm

# References

**Rohde & Schwarz documents**

* [R&S AMIQ Operating Manual](/assets/amiq/AMIQ_OperatingManual_en_08.pdf)
* [R&S AMIQ Service Manual with schematic](/assets/amiq/Rohde_Schwarz_AMIQ_Service_Manual_with_schematics.pdf)
* [R&S AMIQ Overview](/assets/amiq/AMIQ_overview.PDF)
* [R&S AMIQ Datasheet](/assets/amiq/Rohde-Schwarz-AMIQ04-Datasheet.pdf)

* [R&S Floppy Disk Control of the I/Q Modulation Generator AMIQ](/assets/amiq/amiq_floppy_disc_control.pdf)
* [R&S Software WinIQSIM for Calculating I/Q Signals for Modulation Generator R&S AMIQ](/assets/amiq/Software Manual WinIQSIM - ES Documentation.pdf)
* [R&S Creating Test Signals for Bluetooth with AMIQ / WinIQSIM and SMIQ](/assets/amiq/R&S - Creating Test Signals for Bluetooth with AMIQ.pdf)
* [R&S WCDMA Signal Generator Solutions](/assets/amiq/R&S - WCDMA Signal Generator Solutions.pdf)
* [R&S Golden devices: ideal path or detour?](/assets/amiq/R&S Golden devices - ideal path or detour.pdf)
* [R&S Demonstration of BER Test with AMIQ controlled by WinIQSIM](/assets/amiq/R&S - Demonstration of BER Test with AMIQ controlled by WinIQSIM.pdf)

**Other AMIQ content on the web**

* [Lost Manual - Rohde & Schwarz](https://www.lost-manuals.com/en/manufacturer/rohde-schwarz)
* [R&S Groups.io AMIQ repair thread](https://groups.io/g/Rohde-and-Schwarz/topic/r_s_amiq_generator_need/52310294)
* [EEVBlog repair discussion](https://www.eevblog.com/forum/testgear/harddisk-image-for-rs-amiq-generator/)
* [EEVBlog AMIQ license key comment](https://www.eevblog.com/forum/testgear/enabling-options-for-rs-test-equipment/msg3468382/#msg3468382)
* [EEVBlog AMIQ license key comment](https://www.eevblog.com/forum/testgear/enabling-options-for-rs-test-equipment/msg4626139/#msg4626139)
* [EEVBlog AMIQ + SFQ as vector signal generator](https://www.eevblog.com/forum/testgear/rs-smiq-as-a-replacement-for-a-general-signal-generator/msg5400308/#msg5400308)
* [How to get error out of AMIQ?](https://forums.ni.com/t5/UVLabVIEW/How-to-get-errors-form-R-amp-S-AMIQ/td-p/3639064)

* [zw-ix has a blog - Getting an Rohde Schwarz AMIQ up and running](https://zw-ix.nl/blog/2021/02/09/getting-an-rohde-schwarz-amiq-up-and-running/)
* [zw-ix has a blog - Connecting a Rohde Schwarz AMIQ to a SMIQ04](https://zw-ix.nl/blog/2021/02/09/494/)

* [Bosco tweets](https://x.com/BoscoMac/status/1860000781128380629)


**Recapping**

* [Choosing Capacitors to Recap Old Electronics](https://www.youtube.com/watch?app=desktop&v=6PKaj9-1xIs&t=0s)
* [Six Common Mistakes Made When Recapping Vintage Electronics](https://www.youtube.com/watch?v=BeDKwi-GJRI)

**Related content**

* [The Signal Path - Teardown, Repair & Analysis of a Rohde & Schwarz AFQ100A I/Q (ARB) Modulation Generator](https://www.youtube.com/watch?v=6aRZGOcdGUE)
* [Analog Devices - Optimization of EVM Performance in IQ Modulators](https://www.analog.com/en/resources/technical-articles/optimization-of-evm-performance-in-iq-modulators.html)

    Uses an AMIQ in the test setup


