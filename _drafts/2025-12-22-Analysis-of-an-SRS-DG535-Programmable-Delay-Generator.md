---
title: Circuit Analysis of the Programmable Delay Generator of an SRS DG535
date: 2025-12-22 00:00:00 -1000
categories:
---

* TOC
{:toc}

# Introduction

In my previous blog post, I repaired an SRS DG535. When given a trigger,
this instrument can create a delayed pulse on any of its 4 main outputs.
The delay can be up to 1000 seconds and can be specified with a precision
of 5 ps.

I was curious about how SRS managed to do this so I studied the schematic,
built an LTspice model, and ran a bunch of simulations to get a better
understanding.

In this blog post, I explain to myself what I've learned. 

I'm a digital design engineer by trade and paid little attention 
during analog classes more than 30 years ago, so a big disclaimer is in
order: *take everything that follows with a big grain of salt!*

# DG535 Architecture

It's not complicated to create pulse delay generator as long as delay precision and jitter
requirements are larger than the clock period of the internal digital logic: a simple digital
counter will do. But when the timing precision is much smaller than the clock speeds, you need 
analog wizardry to make it happen. 

SRS includes detailed schematics and theory of operation for many of their products and the
DG535 is no exception. It's such a great way to study and learn how non-trivial problems
were solved 40 years ago.

![DG535 block diagram](/assets/dg535/DG535_block_diagram.jpg)

The DG535 uses a combined digital/analog approach to create delays that are up to 1000s long.
Using an internal clock of 80 MHz, the digital delay can be specified with 12.5ns of precision.
The remainder is handled by analog jitter measurement block and an analog delay generator.

The waveform below shows how that works:

[![DG535 digital/analog waveform](/assets/dg535/dg535-waveform.svg)](/assets/dg535/dg535-waveform.svg)
*(Click to enlarge)*

Since the external trigger signal and the internal clock are asynchronous[^async], the delay
between the rising edge of the trigger signal and the next internal clock edge will be an
unknown and constantly changing value between 0 and 12.5ns.

[^async]: The digital clock is generated from an internal or external 10 MHz clock. You
          could make the external trigger signal synchronous to the digital clock by generating
          it from the same 10 MHz clock. In that case, the jitter component would be
          constant but you'd still have to take it into account when setting the overall
          delay.

If the user has programmed a total delay of 78.1 ns, the digital delay can be set to
5 clock cycles (62.5 ns). The remainder 15.6 ns, is dealt with in the analog domain.
The analog delay that must be added by the DG535 is the difference between the remainder
and the jitter. 

Let's work our way back and first look at how the analog delay is generated:

![Analog delay schematic](/assets/dg535/dg535-analog_delay.svg)

It works as follows: a 12-bit DAC provides a voltage to set a delay from 0 to 12.5ns. If
you're wondering where the 5 ps of precision is coming from: 12.5 ns / (2^12) = 3 ps. Close
enough! At the start, a capacitor is discharged to ground through a resistor. When the delay 
must generated, the input of the capacitor is switched to a constant current source, causing
the voltage on the capacitor to rise linearly in time. A comparator checks the capacitor
voltage against the DAC voltage. When the capacitor voltage exceeds the one of the DAC,
the comparator flips and its output is deasserted.

It's simple in practise, but to make it work 

If you look carefully in the schematic, you notice that the right side input of the
comparator comes from a net that is called Vjitter. This is a crucial element in bringing
down jitter that is caused by the asynchronous crossing between the external trigger
input and the internal 80 ns clock. Vjitter is a voltage that proportional to the delay
between the starting edge of the external trigger and the first rising edge of the 80 MHz
clock. While the output delay is generated by the C-charging circuit to convert a digital
value to a time, the Vjitter circuit does the opposte: a capacitor is charged for the duration
between the 2 pulses and the output, Vjitter, reflects this time. It's a technique called
"analog interpolation" that is used by time interval and frequency counters such as the
SRS SR620. I briefly touch this in my blog post about linear regression in frequency
counters.

By compare the voltage of the delay generator against Vjitter, the DG535 is essentially
subtracting the analog output delay from the delay between external trigger and the clock.
If the charging slope of the capacitor in both circuit is carefully calibrated to be the same,
the overall delay generator becomes immune to the jitter introduced by the 80 MHz clock.

# References


# Footnotes

