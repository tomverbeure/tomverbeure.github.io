---
layout: post
title: TDS 220 Projects
date:   2025-05-18 00:00:00 -1000
categories:
---

* TOC
{:toc}

# Introduction

I bought a [Tektronix TDS220](https://w140.com/tekwiki/wiki/TDS220) at the
[electronics flea market](https://www.electronicsfleamarket.com). The
seller told me that it worked but that the screen flickered a bit and that
this model is known to have issues with leaking capacitors.

# Recapping

* Opening up [Youtube video](https://www.youtube.com/watch?v=PHB2XC_l7Eg)
* Remove handle
* Remove power switch knob
* Remover the GPIB module, otherwise the back won't come off
* Remove 2 screws with a Torx 15 screwdriver
* Remove back. Insert screwdriver as shown in picture
* Remove 2 connectors
* Remove PCB by pulling back 2 tabs

Capacitor list:

| **#** | **Indicator** | **Capacitance** | **Voltage** | **Location**          |
|-------|---------------|-----------------|-------------|-----------------------|
| 1     | C22           | 470 uF          | 450V        | Largest on the PCB    |
| 2     | C13           | 2200 uF         | 6.3V        | Next to connector CN2 |
| 3     | C12           | 2200 uF         | 6.3V        | Next to C13           |
| 4     | C11           | 2200 uF         | 6.3V        | Next to C12           |
| 5     | C14           | 1000 uF         | 6.3V        | Next to C11           |
| 6     | C15           | 470 uF          | 6.3V        | Between C13 and C12   |
| 7     | C21           | 47 uF           | 16V         | Close AULT KOREA      |
| 8     | C18           | 22 uF           | 35V         | Next to CN2           |
| 9     | C6            | 22 uF           | 35V         | Next to IC1           |
| 10    | C17           | 4.7 uF          | 50V         | Next to C16           |
| 11    | C10           | 2.2 uF          | 50 V        | Next to CN2           |


* 1x 47 uF - 450 V              
    * C22 - largest cap

    * old 43uF / 0.92 Ohm
    * new 44uF / 0.11 Ohm

* 3x 2200 uF - 6.3 V
    * C13 - next to connector CN2
    * C12 - next to C13
    * C11 - next to C12


    * old 1800 uF 0.0 Ohm (120 Hz)
    * old 1883 uF 0.0 Ohm (120 Hz)
    * old 1753 uF 0.0 Ohm (120 Hz)
    

* 1x 1000 uF - 6.3 V
    * C14 - next to C11

    * old 843 u/f 0.2 Ohm (120 Hz)


* 1x 470 uF - 6.3V
    * C15 - next to IC3

    * old 415 uF 0.4 Ohm (120 Hz)
    * new 440 uF 0.2 Ohm (120 Hz)


* 1x 47 uF - 16 V
    * C21 - next to AULT KOREA

    * old 45uF 2.2 Ohm (120 Hz)

* 2x 22 uF - 35 V
    * C18 - next to connecter CN2
    * C6 - next to IC1 

    * old 19 uF 10 Ohm (120 Hz)
    * old 20 uF 7 Ohm (120 Hz)

* 1x 4.7 uF - 50 V
    * C17 - next to C16

    * old 4.7 uF 6.4 Ohm (120 Hz)

* 1x 2.2 uF - 50 V
    * C10 - next to CN2

    * 2.2 uF 15 Ohm (120 Hz)



* Can't update the firmware without a programmer: https://www.eevblog.com/forum/testgear/reverse-engineering-tds2cmtds2mm/msg4396288/#msg4396288

# Logic Analyzer on MacOS

* Download, install and run [XQuartz](https://www.xquartz.org)
* Following [instructions of old blog post to reserve fixed IP address](https://tomverbeure.github.io/2023/12/26/Controlling-an-HP-1670G-with-Your-Linux-PC-X-Server.html#reserving-a-fixed-ip-address-for-the-logic-analyzer) for logic analyzer
    * Mac ip address: `ifconfig -a | grep 192". In my case: 192.168.1.40
    * Display: 0    -> results in TCP requests to port 6000 (which is XQuartz)
      ```
tom@Toms-MacBook-Air ~ % echo $DISPLAY
/private/tmp/com.apple.launchd.S6HtJ07gdt/org.xquartz:0
      ```
    * Screen: 0     -> otherwise, it doesn't work
* Copy LG165.BDF and SM165.BDF fonts to ~/.fonts
    * No need to create a fonts.dir file: XQuartz does this automatically at startup.
* After starting XQuartz:
    * In Quartz -> Settings -> Security
        * Disable "Authenticate connections"
        * Enable "Allow connections from network clients"
    * EXIT XQuartz!
* Restart XQuartz
    * In xterm console, type: `xhost+192.168.1.200"
        * You need to do this every time. See [this issue in XQuartz github](https://github.com/XQuartz/XQuartz/issues/287).
    * On the logic analyzer: click Connect


# FTP on MacOS

* `brew install lftp`
* ftp 192.168.1.200 
    * login data
    * No password
    * set ftp:passive-mode no
        * Avoid stall after "PASV command not implemented"
    * after this, cd and get work fine.

# 1670G get data files

* See section 19 in User Guide
* raw: use ftp to get data from /slot_a/data.raw
    * data.raw has LIF header. Described in programmers guide.
* txt: use ftp to get data from /slot_a/data.asc -> *.txt
* slot_b is for oscilloscope data

# 1670G telnet

* `brew install telnet`
* `telnet 192.168.1.200 5025`
    * `*idn?`

# TDS2MM traces:

* Pin 33 toggles:
    * 0x7B0000      -> polling for presence?
    * When present: returns 0xC1
    * CPU address is 0x457897
    * When present, reads this later:
    * 0x6000C, D, E, F:
      Data: 0x00, 0x70, 0x00, 0x00
      Read from ROM?


# TDS2xx design and connector

* [Pinout](https://www.eevblog.com/forum/testgear/reverse-engineering-tds2cmtds2mm/msg4040383/#msg4040383)

    [![Pinout](/assets/tds220/Extension_Connector.jpg)](/assets/tds220/Extension_Connector.jpg)
    *(Click to enlarge)*

* ![HP pod pinout](/assets/tds220/HP_pod_pinout.png)
    

# TDS2MM

* NFM TDS2CM to TDS2MM video: https://www.youtube.com/watch?v=MKwDZn6nyXo

**Original Components:**

* [AT27C040-70 EEPROM ](https://www.digikey.com/en/products/detail/microchip-technology/AT27C040-70JU/1008562)
    * 512KB
    * 32PLCC
    * $8
    * Used for TDS2MM

* [28C64 EEPROM](AT28C64B-15JU)
    * 64KB
    * 32PLCC
    * $6
    * Used for TDS2CM

* [Nec D432256BGU-85L SRAM](https://www.alldatasheet.com/datasheet-pdf/download/6974/NEC/D43256BGU.html)
    * SRAM
    * 32KB
    * $3
    * Used for TDS2CM

* [IS62C1024AL-35 SRAM](https://www.digikey.com/en/products/detail/issi-integrated-silicon-solution-inc/IS62C1024AL-35QLI-TR/1557477)
    * SRAM
    * TDS2MM
    * 128KB
    * $2
    * Used for TDS2MM

* [NAT9914APL](https://www.farnell.com/datasheets/3185071.pdf)
    * GPIB
    * eBay only

* [SN68681C1A44](https://www.nxp.com/docs/en/data-sheet/SCC68681.pdf)
    * UART
    * eBay only

* PAL U104
    * Address decoder
    * No clock
    * From connector:
        * A[20:17]
        * LDS_ 
        * P33 (???)

**FFT Only**

* [EEVblog - Enable FFT function on TDS210/TDS220/TDS224](https://www.eevblog.com/forum/testgear/enable-fft-function-on-tds210tds220tds224)

Components:

* 4Mbit/512KB FLASH: [SST39SF040-55-4C-NHE-T](https://www.digikey.com/en/products/detail/microchip-technology/SST39SF040-55-4C-NHE-T/2615114)
    * $2.95
    * [32PLCC socket](https://www.digikey.com/en/products/detail/adam-tech/PLCC-32-AT/9833049)
        * $1.21
* 1Mbit/128KB SRAM: [IS62C1024AL-35QLI](https://www.digikey.com/en/products/detail/issi-integrated-silicon-solution-inc/IS62C1024AL-35QLI-TR/1557477)
    * $2.13
* PLD 16V8: [ATF16V8BQL-15JU](https://www.digikey.com/en/products/detail/microchip-technology/ATF16V8BQL-15JU/1008459)
    * $1.49
    * [20PLCC socket](https://www.digikey.com/en/products/detail/adam-tech/PLCC-20-AT/9833051)
        * $1.10
* Bus Transceiver: 2x [SN74AHCT245DW](https://www.digikey.com/en/products/detail/texas-instruments/SN74AHCT245DWR/276385)
    * 2x $0.44
* 50-pin connector: [A3-50DA-2DS(71)](https://www.digikey.com/en/products/detail/hirose-electric-co-ltd/A3-50DA-2DS-71/3977627)
    * $6.60

Total component cost: $16.36

**Alternative design**

* Total memory needed: 1MB -> 8Mbit

* Async SRAM 8Mbit/1MB
    * [IS62WV10248EBLL-45TLI](https://www.digikey.com/en/products/detail/issi-integrated-silicon-solution-inc/IS62WV10248EBLL-45TLI/5320095)
    * $5.41
    * Could do: 512KB EEPROM + 128KB in RP2040
* Sync SRAM 8Mbit/1MB
    * [RMLV0808BGSB-4S2#HA0](https://www.digikey.com/en/products/detail/renesas-electronics-corporation/RMLV0808BGSB-4S2-HA0/6073050)
    * $5.63
* SPI Flash 4Mbit/512KB
    * $0.31
* [T8Q144C4 FPGA](https://www.digikey.com/en/products/detail/efinix-inc/T8Q144C4/11591363)
    * $7
* 50-pin connector: [A3-50DA-2DS(71)](https://www.digikey.com/en/products/detail/hirose-electric-co-ltd/A3-50DA-2DS-71/3977627)
    * $6.60

Total component cost: $19.32

# References

* https://www.eevblog.com/forum/repair/power-supply-of-tds-220-old-caps-47uf-or-68uf-450v/

* Recap list:
  https://www.eevblog.com/forum/testgear/tektronix-tds210-teardown-and-bnc-replacement/msg1722653/#msg1722653

* Scope with same probe compensation issue:
  https://www.eevblog.com/forum/repair/tektronix-tds-2002b-repair/msg5170455/#msg5170455

  Looks like a bad BNC connector.

* TDS2024 PSU repair:
  https://www.eevblog.com/forum/repair/tektronix-tds2024-oscilloscope-repair-log/

* [TDS2CM reverse engineering](https://www.eevblog.com/forum/testgear/reverse-engineering-tds2cmtds2mm/)

    * [TDS2MM schematic](https://www.eevblog.com/forum/testgear/reverse-engineering-tds2cmtds2mm/msg4040995/#msg4040995)
    * [schematic local copy](/assets/tds220/Tek_TDS2CM_TDS2MM.pdf)

* Enable FFT HW module:
  https://www.eevblog.com/forum/testgear/enable-fft-function-on-tds210tds220tds224

  First post contains the the schematic. Shows that pin 33 is called "_MS".

  * [PAL disassembly](https://www.eevblog.com/forum/testgear/enable-fft-function-on-tds210tds220tds224/msg5464276/#msg5464276)


# Measurements

* CPU: MC68EC000FN8
    * [M6800 8/16/32-bit microprocessor manual](https://www.nxp.com/docs/en/reference-manual/MC68000UM.pdf)
        * Section 4: 8-bit operation
        * Read:
            * S0-R: M: Set FC, set RnW
            * S1-F: M: Set address
            * S2-R: M: Assert nAS/nLDS
            * S3-F: Idle
            * S4-R: S: assert nDTACK
            * S5-F: Idle 
            * S6-R: S: Drive Data
            * S7-F: M: Deassert nAS/nLDS
            * S8-R: S: Remove Data, deassert nDTACK

* Signal description:
  * nAS: input: address select

  * nBG: input: Bus arbitration control

* CLK: 7.5MHz, period 132ns
* nAs: goes low on riding edge of CLK. Stays low for 2.5 clock cycles (330ns), stays high for 1.5 clock cycle (200ns)
* R/nW: read pulse 120ns
* A0: smallest high is 530ns

Power up:
* VDD to CLK 7MHz: 7.6ms
* VDD to SRAM nCS: 1.86s 
